#!/bin/sh
# Loads every `*.env` files in the home and in the .env.d folders
# And every `*.alias` files in the home and in the .alias.d folders
# And every `*.$LOADENV_RC_EXTS` files in the home and in the .rc.d folders
[ ! "$QUIET" ] && echo "Loading Environment"
set -a

if [ -z "$XDG_BIN_HOME" ]; then
	script_location=$(
		cd "${0%\/*}" || exit
		pwd
	)
	# Assume it's this directory if not available
	XDG_BIN_HOME="$script_location"
fi


# shellcheck source=/dev/null
DIR="$XDG_CONFIG_HOME" REGEX=".*\.env" . "$XDG_BIN_HOME/sourcein"
# shellcheck source=/dev/null
DIR="$XDG_CONFIG_HOME/environment.d" REGEX=".*\.env" . "$XDG_BIN_HOME/sourcein"

# shellcheck source=/dev/null
# Load if no already loaded
if [ ! "$CONF_LOADED" ] || [ "$LOAD_CONF" ]; then
	[ ! "$QUIET" ] &&`` echo "Manually loading *.conf files!"
	DIR="$XDG_CONFIG_HOME/environment.d" REGEX=".*\.conf" . \
		"$XDG_BIN_HOME/sourcein"
fi

[ ! "$QUIET" ] && echo "Loading Aliases"
# shellcheck source=/dev/null
DIR="$XDG_CONFIG_HOME" REGEX=".*\.alias" . "$XDG_BIN_HOME/sourcein"
# shellcheck source=/dev/null
DIR="$XDG_CONFIG_HOME/alias.d" REGEX=".*\.alias" . "$XDG_BIN_HOME/sourcein"

[ ! "$QUIET" ] && echo "Loading every \
	.$(echo "${LOADENV_RC_EXTS:-sh}" | sed 's@ @ .@g') rc files"
# shellcheck source=/dev/null
DIR="$XDG_CONFIG_HOME/rc.d" \
	REGEX=".*\.\($(echo "${LOADENV_RC_EXTS:-sh}" | sed 's@ @\\|@g')\)" \
	. "$XDG_BIN_HOME/sourcein"

set +a
